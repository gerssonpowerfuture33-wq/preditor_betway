<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Preditor Universal de Futebol Infinito 2025</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.7.2/socket.io.min.js"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#3b82f6',
                        secondary: '#1e40af', 
                        accent: '#f59e0b',
                        success: '#10b981',
                        warning: '#f59e0b',
                        danger: '#ef4444'
                    }
                }
            }
        }
    </script>
    <style>
        .gradient-bg {
            background: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 50%, #6366f1 100%);
        }
        .market-card {
            transition: all 0.3s ease;
            border-left: 4px solid;
        }
        .market-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        .confidence-bar {
            height: 6px;
            border-radius: 3px;
            background: #e5e7eb;
            overflow: hidden;
        }
        .confidence-fill {
            height: 100%;
            border-radius: 3px;
            transition: width 0.8s ease;
        }
        .priority-high { border-left-color: #10b981; }
        .priority-medium { border-left-color: #f59e0b; }
        .priority-low { border-left-color: #6b7280; }
        
        .stake-high { background: #10b981; color: white; }
        .stake-medium { background: #f59e0b; color: white; }
        .stake-normal { background: #3b82f6; color: white; }
        .stake-low { background: #6b7280; color: white; }
        
        .pulse-online {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.7; }
            100% { opacity: 1; }
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .ad-space {
            background: linear-gradient(135deg, #f8fafc, #e2e8f0);
            border: 2px dashed #cbd5e1;
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Header -->
    <header class="gradient-bg text-white shadow-2xl">
        <div class="container mx-auto px-4 py-4">
            <div class="flex justify-between items-center">
                <div class="flex items-center space-x-3">
                    <div class="p-2 bg-white/20 rounded-xl">
                        <i class="fas fa-infinity text-2xl text-accent"></i>
                    </div>
                    <div>
                        <h1 class="text-2xl font-bold">Preditor Universal de Futebol Infinito</h1>
                        <p class="text-blue-100 text-sm">Sistema Inteligente de Previsões 2025</p>
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <div class="flex items-center space-x-2 bg-blue-800/50 px-4 py-2 rounded-full">
                        <span class="w-3 h-3 bg-green-400 rounded-full pulse-online"></span>
                        <span class="font-medium" id="online-count">2.847</span>
                        <span class="text-blue-200">online</span>
                    </div>
                    <div class="text-sm bg-black/20 px-3 py-1 rounded-lg">
                        <i class="fas fa-clock mr-2"></i>
                        <span id="current-time">--:--:--</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto px-4 py-8">
        <div class="grid grid-cols-1 xl:grid-cols-4 gap-8">
            <!-- Left Column - Input Section -->
            <div class="xl:col-span-1">
                <div class="bg-white rounded-2xl shadow-xl p-6 mb-6 border border-gray-100">
                    <h2 class="text-xl font-bold mb-6 flex items-center text-gray-800">
                        <i class="fas fa-calculator mr-3 text-primary text-2xl"></i>
                        Dados do Confronto
                    </h2>
                    
                    <div class="space-y-6">
                        <!-- Team Inputs -->
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">
                                    <i class="fas fa-home mr-2 text-primary"></i>
                                    Equipa Casa
                                </label>
                                <input type="text" id="team-a" 
                                    class="w-full p-4 border-2 border-gray-200 rounded-xl focus:ring-2 focus:ring-primary focus:border-primary transition"
                                    placeholder="Ex: Benfica" value="Benfica">
                            </div>
                            
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">
                                    <i class="fas fa-plane mr-2 text-secondary"></i>
                                    Equipa Fora
                                </label>
                                <input type="text" id="team-b" 
                                    class="w-full p-4 border-2 border-gray-200 rounded-xl focus:ring-2 focus:ring-secondary focus:border-secondary transition"
                                    placeholder="Ex: Porto" value="Porto">
                            </div>
                        </div>
                        
                        <!-- Probability Inputs -->
                        <div class="bg-gradient-to-r from-blue-50 to-indigo-50 p-5 rounded-xl border border-blue-100">
                            <h3 class="text-lg font-bold mb-4 text-gray-800 flex items-center">
                                <i class="fas fa-chart-pie mr-2 text-accent"></i>
                                Probabilidades 1X2 (%)
                            </h3>
                            
                            <div class="grid grid-cols-3 gap-3 mb-3">
                                <div class="text-center">
                                    <label class="block text-xs font-semibold text-gray-600 mb-2" id="team-a-label">CASA</label>
                                    <input type="number" id="prob-a" min="0" max="100" 
                                        class="w-full p-3 border-2 border-blue-200 rounded-lg text-center text-lg font-bold text-blue-700 focus:ring-2 focus:ring-blue-500"
                                        value="48">
                                </div>
                                <div class="text-center">
                                    <label class="block text-xs font-semibold text-gray-600 mb-2">EMPATE</label>
                                    <input type="number" id="prob-draw" min="0" max="100" 
                                        class="w-full p-3 border-2 border-yellow-200 rounded-lg text-center text-lg font-bold text-yellow-700 focus:ring-2 focus:ring-yellow-500"
                                        value="28">
                                </div>
                                <div class="text-center">
                                    <label class="block text-xs font-semibold text-gray-600 mb-2" id="team-b-label">FORA</label>
                                    <input type="number" id="prob-b" min="0" max="100" 
                                        class="w-full p-3 border-2 border-red-200 rounded-lg text-center text-lg font-bold text-red-700 focus:ring-2 focus:ring-red-500"
                                        value="24">
                                </div>
                            </div>
                            
                            <div class="flex justify-between items-center px-2">
                                <span class="text-sm text-gray-600">Total:</span>
                                <span id="prob-sum" class="text-lg font-bold text-gray-800">100%</span>
                            </div>
                        </div>
                        
                        <!-- Action Buttons -->
                        <div class="space-y-3">
                            <button id="calculate-btn" 
                                class="w-full bg-gradient-to-r from-primary to-secondary hover:from-secondary hover:to-primary text-white font-bold py-4 px-6 rounded-xl transition-all duration-300 transform hover:scale-105 shadow-lg flex items-center justify-center">
                                <i class="fas fa-bolt mr-3 text-xl"></i>
                                CALCULAR PREVISÕES
                            </button>
                            
                            <button id="clear-btn"
                                class="w-full bg-gradient-to-r from-gray-500 to-gray-700 hover:from-gray-600 hover:to-gray-800 text-white font-semibold py-3 px-6 rounded-xl transition-all duration-300 flex items-center justify-center">
                                <i class="fas fa-broom mr-2"></i>
                                LIMPAR DADOS
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Espaço para Anúncios -->
                <div class="ad-space rounded-2xl p-6 mb-6 text-center">
                    <div class="text-xs text-gray-500 mb-2">ESPAÇO PUBLICITÁRIO</div>
                    <div class="h-32 flex items-center justify-center rounded-lg bg-gray-100">
                        <span class="text-gray-400">Anúncio</span>
                    </div>
                </div>
                
                <!-- System Stats -->
                <div class="bg-white rounded-2xl shadow-lg p-6 border border-gray-100">
                    <h3 class="text-lg font-bold mb-4 text-gray-800 flex items-center">
                        <i class="fas fa-chart-line mr-2 text-success"></i>
                        Estatísticas do Sistema
                    </h3>
                    
                    <div class="space-y-3" id="system-stats">
                        <div class="grid grid-cols-2 gap-4">
                            <div class="text-center p-3 bg-green-50 rounded-lg">
                                <div class="text-2xl font-bold text-green-600">2.847</div>
                                <div class="text-xs text-green-700">Utilizadores Online</div>
                            </div>
                            <div class="text-center p-3 bg-blue-50 rounded-lg">
                                <div class="text-2xl font-bold text-blue-600">1.542</div>
                                <div class="text-xs text-blue-700">Previsões Hoje</div>
                            </div>
                            <div class="text-center p-3 bg-purple-50 rounded-lg">
                                <div class="text-2xl font-bold text-purple-600">82%</div>
                                <div class="text-xs text-purple-700">Taxa de Sucesso</div>
                            </div>
                            <div class="text-center p-3 bg-orange-50 rounded-lg">
                                <div class="text-2xl font-bold text-orange-600">18</div>
                                <div class="text-xs text-orange-700">Mercados</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Right Column - Results -->
            <div class="xl:col-span-3">
                <!-- Best Pick Banner -->
                <div id="best-pick-banner" class="hidden bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-2xl p-6 mb-6 shadow-xl">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center space-x-4">
                            <div class="p-3 bg-white/20 rounded-xl">
                                <i class="fas fa-crown text-2xl"></i>
                            </div>
                            <div>
                                <h3 class="text-xl font-bold">MELHOR APOSTA DO JOGO</h3>
                                <p class="text-green-100" id="best-pick-text">Carregando...</p>
                            </div>
                        </div>
                        <div class="text-right">
                            <div class="text-3xl font-bold" id="best-pick-confidence">--%</div>
                            <div class="text-green-200 text-sm">Confiança</div>
                        </div>
                    </div>
                </div>

                <!-- Intel Probabilities -->
                <div id="intel-probabilities" class="hidden bg-white rounded-2xl shadow-lg p-6 mb-6 border border-gray-100">
                    <h3 class="text-lg font-bold mb-4 text-gray-800 flex items-center">
                        <i class="fas fa-brain mr-2 text-primary"></i>
                        Probabilidades Inteligentes
                    </h3>
                    <div class="grid grid-cols-3 gap-4 text-center">
                        <div>
                            <div class="text-2xl font-bold text-blue-600" id="intel-home">--%</div>
                            <div class="text-sm text-gray-600" id="intel-home-team">CASA</div>
                        </div>
                        <div>
                            <div class="text-2xl font-bold text-yellow-600" id="intel-draw">--%</div>
                            <div class="text-sm text-gray-600">EMPATE</div>
                        </div>
                        <div>
                            <div class="text-2xl font-bold text-red-600" id="intel-away">--%</div>
                            <div class="text-sm text-gray-600" id="intel-away-team">FORA</div>
                        </div>
                    </div>
                </div>
                
                <!-- Top Recommendations -->
                <div id="top-recommendations" class="hidden bg-white rounded-2xl shadow-xl p-6 mb-6 border border-gray-100">
                    <h2 class="text-xl font-bold mb-6 flex items-center text-gray-800">
                        <i class="fas fa-star mr-3 text-accent text-2xl"></i>
                        Top 5 Recomendações
                    </h2>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4" id="recommendations-container">
                        <!-- Top recommendations will be loaded here -->
                    </div>
                </div>
                
                <!-- Game Analysis -->
                <div id="game-analysis" class="hidden bg-gradient-to-r from-blue-500 to-indigo-600 text-white rounded-2xl p-6 mb-6 shadow-xl">
                    <h3 class="text-lg font-bold mb-3 flex items-center">
                        <i class="fas fa-brain mr-2"></i>
                        Análise Inteligente do Jogo
                    </h3>
                    <p id="analysis-text" class="text-blue-100 leading-relaxed">
                        A análise do jogo será gerada aqui após o cálculo...
                    </p>
                </div>

                <!-- Espaço para Anúncios Horizontal -->
                <div class="ad-space rounded-2xl p-4 mb-6 text-center hidden md:block">
                    <div class="text-xs text-gray-500 mb-2">PUBLICIDADE</div>
                    <div class="h-20 flex items-center justify-center rounded-lg bg-gray-100">
                        <span class="text-gray-400">Banner Publicitário</span>
                    </div>
                </div>
                
                <!-- All Markets -->
                <div class="bg-white rounded-2xl shadow-xl p-6 border border-gray-100">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-xl font-bold flex items-center text-gray-800">
                            <i class="fas fa-list-alt mr-3 text-primary text-2xl"></i>
                            Todos os 18 Mercados Analisados
                        </h2>
                        <div class="text-sm text-gray-500" id="results-count">0/18 mercados</div>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4" id="markets-container">
                        <div class="col-span-2 text-center py-12 text-gray-400">
                            <i class="fas fa-futbol text-6xl mb-4 opacity-50"></i>
                            <p class="text-lg">Insira os dados do jogo e clique em CALCULAR</p>
                            <p class="text-sm mt-2">O sistema irá analisar todos os 18 mercados disponíveis</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="bg-gray-900 text-white py-8 mt-12">
        <div class="container mx-auto px-4">
            <div class="flex flex-col md:flex-row justify-between items-center">
                <div class="mb-6 md:mb-0">
                    <div class="flex items-center space-x-3 mb-3">
                        <i class="fas fa-infinity text-2xl text-accent"></i>
                        <span class="text-xl font-bold">Preditor Universal Infinito</span>
                    </div>
                    <p class="text-gray-400 text-sm">Sistema avançado de previsões desportivas 2025</p>
                </div>
                <div class="text-center md:text-right">
                    <p class="text-gray-400 text-sm">© 2025 Preditor Universal. Todos os direitos reservados.</p>
                    <p class="text-gray-500 text-xs mt-1">Aposte com responsabilidade. Este sistema é para fins informativos.</p>
                </div>
            </div>
        </div>
    </footer>

    <script>
        // Socket.io connection
        const socket = io();
        
        // DOM Elements
        const elements = {
            teamA: document.getElementById('team-a'),
            teamB: document.getElementById('team-b'),
            probA: document.getElementById('prob-a'),
            probB: document.getElementById('prob-b'),
            probDraw: document.getElementById('prob-draw'),
            probSum: document.getElementById('prob-sum'),
            calculateBtn: document.getElementById('calculate-btn'),
            clearBtn: document.getElementById('clear-btn'),
            marketsContainer: document.getElementById('markets-container'),
            recommendationsContainer: document.getElementById('recommendations-container'),
            analysisText: document.getElementById('analysis-text'),
            systemStats: document.getElementById('system-stats'),
            onlineCount: document.getElementById('online-count'),
            currentTime: document.getElementById('current-time'),
            bestPickBanner: document.getElementById('best-pick-banner'),
            bestPickText: document.getElementById('best-pick-text'),
            bestPickConfidence: document.getElementById('best-pick-confidence'),
            topRecommendations: document.getElementById('top-recommendations'),
            gameAnalysis: document.getElementById('game-analysis'),
            resultsCount: document.getElementById('results-count'),
            teamALabel: document.getElementById('team-a-label'),
            teamBLabel: document.getElementById('team-b-label'),
            intelProbabilities: document.getElementById('intel-probabilities'),
            intelHome: document.getElementById('intel-home'),
            intelDraw: document.getElementById('intel-draw'),
            intelAway: document.getElementById('intel-away'),
            intelHomeTeam: document.getElementById('intel-home-team'),
            intelAwayTeam: document.getElementById('intel-away-team')
        };

        // Update team labels
        elements.teamA.addEventListener('input', () => {
            const value = elements.teamA.value || 'CASA';
            elements.teamALabel.textContent = value;
            elements.intelHomeTeam.textContent = value;
        });
        
        elements.teamB.addEventListener('input', () => {
            const value = elements.teamB.value || 'FORA';
            elements.teamBLabel.textContent = value;
            elements.intelAwayTeam.textContent = value;
        });

        // Update probability sum
        function updateProbSum() {
            const sum = parseInt(elements.probA.value) + parseInt(elements.probB.value) + parseInt(elements.probDraw.value);
            elements.probSum.textContent = `${sum}%`;
            
            if (sum !== 100) {
                elements.probSum.classList.add('text-red-500');
            } else {
                elements.probSum.classList.remove('text-red-500');
            }
        }

        [elements.probA, elements.probB, elements.probDraw].forEach(input => {
            input.addEventListener('input', updateProbSum);
        });

        // Clear form
        elements.clearBtn.addEventListener('click', () => {
            elements.teamA.value = '';
            elements.teamB.value = '';
            elements.probA.value = '0';
            elements.probB.value = '0';
            elements.probDraw.value = '0';
            updateProbSum();
            
            // Hide results sections
            elements.bestPickBanner.classList.add('hidden');
            elements.topRecommendations.classList.add('hidden');
            elements.gameAnalysis.classList.add('hidden');
            elements.intelProbabilities.classList.add('hidden');
            
            // Reset markets container
            elements.marketsContainer.innerHTML = `
                <div class="col-span-2 text-center py-12 text-gray-400">
                    <i class="fas fa-futbol text-6xl mb-4 opacity-50"></i>
                    <p class="text-lg">Insira os dados do jogo e clique em CALCULAR</p>
                    <p class="text-sm mt-2">O sistema irá analisar todos os 18 mercados disponíveis</p>
                </div>
            `;
            
            elements.resultsCount.textContent = '0/18 mercados';
        });

        // Calculate predictions
        elements.calculateBtn.addEventListener('click', async () => {
            const teamA = elements.teamA.value.trim() || 'Equipa Casa';
            const teamB = elements.teamB.value.trim() || 'Equipa Fora';
            const probA = parseInt(elements.probA.value) || 0;
            const probB = parseInt(elements.probB.value) || 0;
            const probDraw = parseInt(elements.probDraw.value) || 0;
            
            if (probA + probB + probDraw === 0) {
                alert('Por favor, insira probabilidades válidas!');
                return;
            }
            
            // Show loading state
            elements.calculateBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i> ANALISANDO...';
            elements.calculateBtn.disabled = true;
            
            try {
                const response = await fetch('/api/predict', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        team_a: teamA,
                        team_b: teamB,
                        prob_a: probA,
                        prob_b: probB,
                        prob_draw: probDraw
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    displayResults(data);
                } else {
                    alert('Erro: ' + (data.error || 'Erro desconhecido'));
                }
            } catch (error) {
                alert('Erro de conexão: ' + error.message);
            } finally {
                elements.calculateBtn.innerHTML = '<i class="fas fa-bolt mr-3 text-xl"></i> CALCULAR PREVISÕES';
                elements.calculateBtn.disabled = false;
            }
        });

        // Display results
        function displayResults(data) {
            // Show all sections
            elements.bestPickBanner.classList.remove('hidden');
            elements.topRecommendations.classList.remove('hidden');
            elements.gameAnalysis.classList.remove('hidden');
            elements.intelProbabilities.classList.remove('hidden');
            
            // Update best pick banner
            elements.bestPickText.textContent = data.analysis.best_pick;
            elements.bestPickConfidence.textContent = data.analysis.stats.average_confidence + '%';
            
            // Update intel probabilities
            elements.intelHome.textContent = data.analysis.intel_probabilities.home + '%';
            elements.intelDraw.textContent = data.analysis.intel_probabilities.draw + '%';
            elements.intelAway.textContent = data.analysis.intel_probabilities.away + '%';
            
            // Update game analysis
            elements.analysisText.textContent = data.analysis.game_analysis;
            
            // Display top recommendations
            displayTopRecommendations(data.analysis.top_recommendations);
            
            // Display all markets
            displayAllMarkets(data.predictions);
            
            // Update results count
            elements.resultsCount.textContent = `${data.predictions.length}/${data.analysis.stats.total_markets} mercados`;
        }

        // Display top recommendations
        function displayTopRecommendations(recommendations) {
            elements.recommendationsContainer.innerHTML = '';
            
            recommendations.forEach(market => {
                const priorityClass = `priority-${market.priority.toLowerCase()}`;
                
                const stakeClass = market.stake.includes('ALTO') ? 'stake-high' :
                                market.stake.includes('MÉDIO') ? 'stake-medium' :
                                market.stake.includes('NORMAL') ? 'stake-normal' : 'stake-low';
                
                const card = document.createElement('div');
                card.className = `market-card ${priorityClass} rounded-xl p-4 fade-in bg-white border border-gray-200`;
                card.innerHTML = `
                    <div class="flex justify-between items-start mb-3">
                        <div>
                            <h3 class="font-bold text-gray-800">${market.name}</h3>
                            <p class="text-xs text-gray-500">${market.description}</p>
                        </div>
                        <i class="fas fa-${market.icon} text-lg text-gray-600"></i>
                    </div>
                    <div class="mb-3">
                        <p class="text-sm font-semibold text-gray-700">${market.prediction}</p>
                    </div>
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-xs text-gray-500">Confiança:</span>
                        <span class="text-sm font-bold text-gray-800">${market.confidence}%</span>
                    </div>
                    <div class="confidence-bar mb-3">
                        <div class="confidence-fill ${market.confidence >= 70 ? 'bg-green-500' : market.confidence >= 60 ? 'bg-yellow-500' : 'bg-red-500'}" 
                             style="width: ${market.confidence}%"></div>
                    </div>
                    <div class="flex justify-between items-center mb-2">
                        <span class="text-xs px-2 py-1 rounded ${stakeClass} font-semibold">
                            ${market.stake}
                        </span>
                        <span class="text-xs font-semibold ${market.priority === 'ALTA' ? 'text-green-600' : market.priority === 'MÉDIA' ? 'text-yellow-600' : 'text-gray-600'}">
                            ${market.priority}
                        </span>
                    </div>
                    <div class="text-xs text-gray-500">
                        <i class="fas fa-coins mr-1"></i> Odds: ${market.odds}
                    </div>
                `;
                
                elements.recommendationsContainer.appendChild(card);
            });
        }

        // Display all markets
        function displayAllMarkets(markets) {
            elements.marketsContainer.innerHTML = '';
            
            markets.forEach(market => {
                const priorityClass = `priority-${market.priority.toLowerCase()}`;
                
                const stakeClass = market.stake.includes('ALTO') ? 'stake-high' :
                                market.stake.includes('MÉDIO') ? 'stake-medium' :
                                market.stake.includes('NORMAL') ? 'stake-normal' : 'stake-low';
                
                const card = document.createElement('div');
                card.className = `market-card ${priorityClass} rounded-lg p-4 fade-in bg-white border border-gray-200`;
                card.innerHTML = `
                    <div class="flex justify-between items-start mb-2">
                        <div>
                            <h3 class="font-bold text-gray-800">${market.name}</h3>
                            <p class="text-xs text-gray-500">${market.description}</p>
                        </div>
                        <i class="fas fa-${market.icon} text-gray-600"></i>
                    </div>
                    <div class="mb-3">
                        <p class="text-sm font-semibold text-gray-700">${market.prediction}</p>
                    </div>
                    <div class="flex items-center justify-between mb-1">
                        <span class="text-xs text-gray-500">Confiança:</span>
                        <span class="text-xs font-bold">${market.confidence}%</span>
                    </div>
                    <div class="confidence-bar mb-2">
                        <div class="confidence-fill ${market.confidence >= 70 ? 'bg-green-500' : market.confidence >= 60 ? 'bg-yellow-500' : 'bg-red-500'}" 
                             style="width: ${market.confidence}%"></div>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-xs px-2 py-1 rounded ${stakeClass} font-semibold">
                            ${market.stake}
                        </span>
                        <span class="text-xs ${market.priority === 'ALTA' ? 'text-green-600' : market.priority === 'MÉDIA' ? 'text-yellow-600' : 'text-gray-600'} font-semibold">
                            ${market.priority}
                        </span>
                    </div>
                    <div class="text-xs text-gray-500 mt-1">
                        <i class="fas fa-coins mr-1"></i> ${market.odds}
                    </div>
                `;
                
                elements.marketsContainer.appendChild(card);
            });
        }

        // Update online count and time
        function updateOnlineCount() {
            const baseCount = 2847;
            const variation = Math.floor(Math.random() * 100) - 50;
            elements.onlineCount.textContent = (baseCount + variation).toLocaleString();
        }

        function updateCurrentTime() {
            const now = new Date();
            elements.currentTime.textContent = now.toLocaleTimeString();
        }

        // Socket.io events
        socket.on('connection_established', (data) => {
            console.log('Connected to server:', data.message);
        });

        // Initialize
        updateProbSum();
        updateOnlineCount();
        updateCurrentTime();
        
        setInterval(updateOnlineCount, 8000);
        setInterval(updateCurrentTime, 1000);

        // Load system stats periodically
        async function loadSystemStats() {
            try {
                const response = await fetch('/api/system_stats');
                const data = await response.json();
                
                elements.systemStats.innerHTML = `
                    <div class="grid grid-cols-2 gap-4">
                        <div class="text-center p-3 bg-green-50 rounded-lg">
                            <div class="text-2xl font-bold text-green-600">${data.online_users}</div>
                            <div class="text-xs text-green-700">Utilizadores Online</div>
                        </div>
                        <div class="text-center p-3 bg-blue-50 rounded-lg">
                            <div class="text-2xl font-bold text-blue-600">${data.predictions_today}</div>
                            <div class="text-xs text-blue-700">Previsões Hoje</div>
                        </div>
                        <div class="text-center p-3 bg-purple-50 rounded-lg">
                            <div class="text-2xl font-bold text-purple-600">${data.success_rate}%</div>
                            <div class="text-xs text-purple-700">Taxa de Sucesso</div>
                        </div>
                        <div class="text-center p-3 bg-orange-50 rounded-lg">
                            <div class="text-2xl font-bold text-orange-600">${data.total_markets}</div>
                            <div class="text-xs text-orange-700">Mercados</div>
                        </div>
                    </div>
                `;
            } catch (error) {
                console.error('Error loading system stats:', error);
            }
        }

        // Load system stats every 30 seconds
        setInterval(loadSystemStats, 30000);
        loadSystemStats();
    </script>
</body>
</html>
